var sam=sam||{};(function(n){var t,i=samEditorOptions.media;sam.media=t={buttonId:"#banner-media",adUrl:"#patch_img",adImgId:"#patch_img_id",adName:"#title",adDesc:"#description",init:function(){n(this.buttonId).on("click",this.openMediaDialog)},openMediaDialog:function(n){if(n.preventDefault(),this._frame){this._frame.open();return}var r=wp.media.model.Attachment;this._frame=t.frame=wp.media({title:i.title,button:{text:i.button},multiple:!1,library:{type:"image"}});this._frame.on("ready",function(){});this._frame.state("library").on("select",function(){var n=this.get("selection").single();t.handleMediaAttachment(n)});this._frame.open()},handleMediaAttachment:function(t){var i=t.toJSON();n(this.adUrl).val(i.url);n(this.adImgId).val(i.id);""==n(this.adName).val()&&""!=i.title&&n(this.adName).val(i.title);""==n(this.adDesc).val()&&""!=i.caption&&n(this.adDesc).val(i.caption);""==n(this.adAlt).val()&&""!=i.alt&&n(this.adAlt).val(i.alt)}};n(document).ready(function(){var p=n("#editor_mode").val(),k,u=n("#rc-psi"),f=n("#rc-psc"),e=n("#rc-psd"),w=n("#title"),h=n("#place_id").val(),d=n("#upload-file-button"),c=n("#uploading"),g=n("#uploading-help"),b=n("#load_img"),o,l=0,nt=n("#ads-grid"),a=samEditorOptions.samStatsUrl,v=samEditorOptions.labels;o=samEditorOptions.places;o.pointer="places";t.init();w.tooltip({track:!0});var i=samEditorOptions.options,r,s=[],y={animate:!0,animateReplot:!0,cursor:{showTooltip:!1},series:[{pointLabels:{show:!0},renderer:n.jqplot.BarRenderer,showHighlight:!1,rendererOptions:{animation:{speed:2500},barWidth:15,barPadding:-15,barMargin:0,highlightMouseOver:!1},label:v.hits},{label:v.clicks,rendererOptions:{animation:{speed:2e3}}}],axesDefaults:{pad:0},axes:{xaxis:{tickInterval:1,drawMajorGridlines:!1,drawMinorGridlines:!0,drawMajorTickMarks:!1,rendererOptions:{tickInset:1,minorTicks:1},min:1},yaxis:{rendererOptions:{forceTickAt0:!0}}},highlighter:{show:!0,showLabel:!0,tooltipAxes:"y",sizeAdjust:7.5,tooltipLocation:"ne",useAxesFormatters:!1,tooltipFormatString:v.clicks+": %d"},legend:{show:!0,placement:"ne"}};return k=new AjaxUpload(d,{action:ajaxurl,name:"uploadfile",data:{action:"upload_ad_image"},onSubmit:function(n,t){if(!(t&&/^(jpg|png|jpeg|gif|swf)$/.test(t)))return c.text(i.status),!1;b.show();c.text(i.uploading)},onComplete:function(t,r){c.text("");b.hide();n('<div id="files"><\/div>').appendTo(g);r=="success"?(n("#files").text(i.file+" "+t+" "+i.uploaded).addClass("updated").delay(3e3).fadeOut(1e3,function(){n(this).remove()}),p=="item"?n("#ad_img").val(i.url+t):p=="place"&&n("#patch_img").val(i.url+t)):n("#files").text(t+" "+r).addClass("error").delay(3e3).fadeOut(1e3,function(){n(this).remove()})}}),n.post(a,{action:"load_stats",id:h,sm:l}).done(function(t){s=[t.hits,t.clicks];n("#total_hits").text(t.total.hits);n("#total_clicks").text(t.total.clicks);r=n.jqplot("graph",s,y)}),n("#tabs").tabs({activate:function(t,i){var u=i.newPanel[0].id;u=="tabs-3"&&r&&(r.destroy(),r=n.jqplot("graph",s,y))}}),n("#image_tools").tabs(),n.post(a,{action:"load_ads",id:h,sm:0}).done(function(n){var t=n.records;nt.w2grid({name:"ads",show:{selectColumn:!1},multiSelect:!1,columns:samEditorOptions.columns,records:t})}),n("#add-file-button").click(function(){var t=i.url+n("select#files_list option:selected").val();return n("#patch_img").val(t),!1}),n("#patch_source_image").click(function(){u.is(":hidden")&&u.show("blind",{direction:"vertical"},500);f.is(":visible")&&f.hide("blind",{direction:"vertical"},500);e.is(":visible")&&e.hide("blind",{direction:"vertical"},500)}),n("#patch_source_code").click(function(){u.is(":visible")&&u.hide("blind",{direction:"vertical"},500);f.is(":hidden")&&f.show("blind",{direction:"vertical"},500);e.is(":visible")&&e.hide("blind",{direction:"vertical"},500)}),n("#patch_source_dfp").click(function(){u.is(":visible")&&u.hide("blind",{direction:"vertical"},500);f.is(":visible")&&f.hide("blind",{direction:"vertical"},500);e.is(":hidden")&&e.show("blind",{direction:"vertical"},500)}),(o.enabled||""==w.val())&&n("#title").pointer({content:"<h3>"+o.title+"<\/h3><p>"+o.content+"<\/p>",position:"top",close:function(){n.ajax({url:ajaxurl,data:{action:"close_pointer",pointer:o.pointer},async:!0})}}).pointer("open"),n("#stats_month").change(function(){l=n(this).val();n.post(a,{action:"load_stats",id:h,sm:l}).done(function(t){s=[t.hits,t.clicks];n("#total_hits").text(t.total.hits);n("#total_clicks").text(t.total.clicks);r&&(r.destroy(),r=n.jqplot("graph",s,y))})}),!1})})(jQuery)